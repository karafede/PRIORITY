
<!doctype html>
<html lang="en">

<style type="text/css">
    body {
            padding: 0;
            margin: 0;
			font-family: Arial, Helvetica, sans-serif;
        }
   
	#map {
	  height: 100%;
	}
	
	/* Optional: Makes the sample page fill the window. */
	html, body {
	  height: 100%;
	  margin: 0;
	  padding: 0;
	}


	.info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
	.legend { text-align: left; line-height: 13px; color: #555; font-size: 1.075em} .legend i { width: 12px; height: 12px; float: left; margin-right: 5px; opacity: 0.7; } 
	.legend_censuary { text-align: left; line-height: 10px; color: #555;  font-size: 10px} 
	.legend_ZMU { text-align: left; line-height: 15px; color: #555;  font-size: 12px} 
	
	#refreshButton {
	  position: absolute;
	  top: 60px;
	  right: 20px;
	  padding: 10px;
	  z-index: 400;
	  color: #000000;
	  background-color:#FFFF00;
	}
	
	
	#home_locations {
	  position: absolute;
	  width: 100%;
	  top: 60px;
	  margin-top: 40px;
	  right: 20px;
	  padding: 10px;
	  z-index: 400;
	  color: #ffffff ;
	  background-color:#000099;
	}
	
	#refreshButton:hover{
		opacity: 0.8;
		cursor: pointer;
    }
	


	  html, body,  #map {
        width : 100%;
        height : 100%;
      }
	.box{	  
		width:15px;
		height:15px;
		border-radius:25px;
		display: inline-block;
		}
	

     /** sidebar menu **/
	.innerDiv{
		position: absolute;
		width: 10%;
		height: 15%;
		background-color: #b2b2ff;
		opacity: 0.8;
		margin-top:  1%;
		margin-left: 5%;
		z-index: 800;
		padding-top: 1%;
		text-overflow:ellipsis;
        overflow:hidden;
		
	}
	

	

    .button {
	    position: absolute;
		left: 2%;
		top: 80%;
		height: 8%;
		width: 7%
        min-width: 7%;
		margin-top: 30%;
		margin-left: 50%;
		z-index: 500;
	    border: none;
	    color: white;
	    padding: 20px;
	    text-align: center;
	    display: inline-block;
	    font-size: 1.5em;
	    margin: 10px 20px;		
	}

		
		
  header, nav {
    left: 2%;
	top: 85%;
  	z-index: 700;
	position: absolute;
	text-align: center;
	margin: 20px 0;
	padding: 10px;
	border-spacing: 5px;
  }

	nav a {
	  text-decoration: none;
	  background: #000000;  /* Black */
	  border-radius: 5px;
	  font-size: 1.2em;
	  color: white;
	  padding: 3px 8px;
	  display: table-cell;
	}
	
	
	nav .col_home {
		background-color: #6b0000;
	}
	
	nav .col_privata {
		background-color: #4CAF50;
	}
	
	
	nav .col_collettivo {
		background-color: #0000ff ;
	}
	
	nav .col_scenari {
		background-color: #ffa500 ;
	}
	
	
	nav .col_impatti {
		background-color: #76a5af ;
	}
	
	
	nav .IEA_statistics {
		background-color: #ededed ;
		color: blue;
	}
	
	
	
		

  /** submit lat lon and input text to Python **/
   main {
		background-color: rgba(51, 170, 51, .3); 
		left: 2%;
		top: 3%;
		z-index: 700;
		position: absolute;
		margin: 2px 0;
		padding: 5px;
		text-overflow:ellipsis;
        overflow:hidden;
    width: 280px;
    height: 500px
	}

	main div {
	  background: transparent; 
	  color: white;
	  padding: 1px;
	  margin: 5px auto;
	}
	

	main div:nth-child(1) {
	  width: 0px;
	  height: 0px;
	   background: transparent;
	}
	

	main div:nth-child(3) {
      width: 170px;
	 background: transparent;
	}
	
	main div:nth-child(4) {
	  width: 270px;
	   background: red;
	}
	
	main div:nth-child(5) {
	  width: 270px;
	 background: transparent;
	}
	
	main div:nth-child(6) {
	   width: 270px;
	    background: blue;
	}
	
	main div:nth-child(7) {
	  width: 270px;
	   background: blue;
	}
	
	main div:nth-child(10) {
	  width: 270px;
	   	 background: blue;
	}
	
	

	
	.inline-block-center {
	  text-align: center;
	}
	
	.flex-center {
	  display: flex;
	  justify-content: center;
	}
	

	h2 {
    margin: 0;
    padding: 0;
	}
	
	
	h3 {
    margin: 0;
    padding: 0;
	}
	
	
	
	/* The Modal (background) */
	.modal {
	  display: none; /* Hidden by default */
	  position: absolute; /* Stay in place */
	  z-index: 700; /* Sit on top */
	  
	  position: absolute;
	   left: 20%;
		top: 4%;
	  width: 50%; /* Full width */
	  height: 70%; /* Full height */
	  overflow: auto; /* Enable scroll if needed */
	  background-color: rgb(0,0,0); /* Fallback color */
	  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
	}

	/* Modal Content/Box */
	.modal-content {
	  z-index: 700;
	  top: 5%;
	  background-color: #fefefe;
	  margin: 5% auto; /* 15% from the top and centered */
	  padding: 1%;
	  border: 1px solid #888;
	  width: 100%; /* Could be more or less, depending on screen size */
	}

	/* The Close Button */
	.close {
	  color: #aaa;
	  float: right;
	  font-size: 28px;
	  font-weight: bold;
	}

	.close:hover,
	.close:focus {
	  color: black;
	  text-decoration: none;
	  cursor: pointer;
	}
	
	
	.video-wrapper {
	  position: relative;
	  height: 0;
	  padding-bottom: 56.25%;
	}

	.video-wrapper iframe {
	   position: absolute;
	   width: 100%;
	   height: 100%;
	   top: 0;
	   left: 0;
	}


.animation_link {
  font-size: 130%;
  color: blue;
  font-weight: bold;
}

.animation_link_heatmap {
  font-size: 130%;
  color: red;
  font-weight: bold;
}

.animation_link_IEA_STATS {
  font-size: 130%;
  color: #0f45d2;
  font-weight: bold;
}


	
	
</style>

<style>

.label {
  color: white;
  padding: 8px;
  font-family: Arial;
  font-weight: bold;
}
.tpl_line {background-color: #2196F3;} /* Blue */


table, th, td {
  border:1px solid black;
   left: 20%;
}


table.center_table {
  margin-left: -15%; 
  //margin-left: 20%;
}



/* Center the loader (SPINNER) */
#loader {
  position: absolute;
  left: 50%;
  top: 50%;
  z-index: 1;
  width: 120px;
  height: 120px;
  margin: -76px 0 0 -76px;
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  // border-top: 16px solid #3498db;
  border-top: 16px solid blue;
  border-right: 16px solid green;
  border-bottom: 16px solid red;
  border-right: 16px solid yellow;
  border-left: 16px solid pink;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;
}

@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Add animation to "page content" */
.animate-bottom {
  position: relative;
  -webkit-animation-name: animatebottom;
  -webkit-animation-duration: 1s;
  animation-name: animatebottom;
  animation-duration: 1s
}

@-webkit-keyframes animatebottom {
  from { bottom:-100px; opacity:0 } 
  to { bottom:0px; opacity:1 }
}

@keyframes animatebottom { 
  from{ bottom:-100px; opacity:0 } 
  to{ bottom:0; opacity:1 }
}

#myDiv {
  display: none;
  text-align: center;
}



div#loading {
    display: none;
	position: absolute;
	left: 50%;
    top: 50%;
    z-index: 700;
	width: 270px;
	height: 270px;
	 margin: -76px 0 0 -76px;
    background: url(/static/loadingimage_TPL.gif) no-repeat;
    cursor: wait;
 }
 
 /* Button changing color when clicked */
 input.btn_color:active { background:yellow; } 


</style>

</head>
  <meta name="description" content="Leaflet Template">
  <title>RdS-ENEA</title>
  <!--meta name="viewport" content="initial-scale=1.0"-->
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
 </head>
 
 
 <!--start the SPINNER or LOADER-->
<div id="loader"></div>

   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>



<body>
<div id="loading"></div>

<main class="inline-block-center">


<!--div style="display:none;" id="myDiv" class="animate-bottom">
  <h2>Tada!</h2>
  <p>Some text in my newly loaded page..</p>
</div-->


<!-- send user coordinates to the Python console-->
	<form action="/points_interest/" method="POST">
		  <div>	
			<input   type='hidden' id='lat' name='lat'  /> <br />
		  </div>
		  <div>
			<input type='hidden' id='lng' name='lng'  /> <br />
		  </div>
		  <h3>Find Point of Interest</h3>
		  <div>
		   <input type="text" onfocus="this.value=''"  name="tag" value='insert dist(m) (>=1000)'><br>
		  </div>
		   <!--div-->
		   <input class="btn btn-primary btn-sm" type="submit" value="find Points of Interest" onclick="$('#loading').show();">
		   
		   <div class="break_line"></div>
		  <!--/div--> 
	</form>
	
	<!--insert new line-->
	<br>
	
	
	
	<h3>Traffic Load by day & time</h3>
	<!--insert new line-->
	<br>
	
	
	<form method="POST" action="/ZMU_day_selector/">
	<span class="label tpl_line">Day:</span>
	  <!--input type="date"   value="2019-10-09"  id="ZMU-day" name="ZMU_day"-->
	   <input type="date" id="registrationday" name="ZMU_day" onchange="this.form.submit()";>
	   <!--button type="submit" class="btn btn-default">Select</button-->
	</form>
	
	<!--insert new line-->
	<br>
	
	
	
	<form method="POST" action="/ZMU_hour_selector/">	
	<span class="label tpl_line">hour:</span>
	<select class="ZMU_hour_selector" name="ZMU_hour" id="registrationhour" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onchange="this.form.submit()";>
			<option value="0">00:00</option>
			<option value="1">01:00</option>
			<option value="2">02:00</option>
			<option value="3">03:00</option>
			<option value="4">04:00</option>
			<option value="5">05:00</option>
			<option value="6">06:00</option>
			<option value="7">07:00</option>
			<option value="8">08:00</option>
			<option value="9">09:00</option>
			<option value="10">10:00</option>
			<option value="11">11:00</option>
			<option value="12">12:00</option>
			<option value="13">13:00</option>
			<option value="14">14:00</option>
			<option value="15">15:00</option>
			<option value="16">16:00</option>
			<option value="17">17:00</option>
			<option value="18">18:00</option>
			<option value="19">19:00</option>
			<option value="20">20:00</option>
			<option value="21">21:00</option>
			<option value="22">22:00</option>
			<option value="23">23:00</option>
		</select>
		<!--input class="btn btn-primary btn-sm" type="submit" value="Select hour"  onclick="$('#loading').show();"-->
	</form>
	
	
	<!--ul>
	{% for item in data_ZMU %}
	<table class="center_table" style="width:100%">
	<tr>
		<th>Day</th>
		<th>hour</th>
	  </tr>
	  <tr>
		<td>{{item.ZMU_day}}</td>
	  </tr>
	</table>
	{% endfor %}
	</ul-->
	
	
	<!--p>The date is: <strong>{{var_ZMU_day}}</strong></p--> 
	
	
	<div class="break_line_1"></div>
	

	
<!--p style="display:inline-block;">
 <input type="button" class="btn_color" onclick = "sendData();" value="1 - Select custom area with button">
  <img src="/static/icons8-pentagon-48.png" style="max-width: 6%;">
</p-->


<!--form method="POST" action="/AGGREGATED_ZMU_border_selector/">
		<input class="btn btn-primary btn-sm" type="submit" onclick="$('#loading').show();" value="2 - Aggregate data within selected area"></p>
</form-->

	
	<form>
	   <h3>Traffic zone data</h3>
     <select class="selector">
		<option  value="Population">Total Population</option>
		<option value="Residences">Residential Buildings</option>
	 </select>
	
	<div class="break_line_1"></div>
	
	<div class="break_line_1"></div>
	
	 <a class="animation_link" href="/animation_FCD/">FCD animation</a></p>
	 
	 <div class="break_line_1"></div>
		
	 <a class="animation_link_heatmap" href="/heatmaps_FCD/"> Heatmaps private mobility</a></p>
	 
	 <!--a class="animation_link_IEA_STATS"  onclick="$('#loading').show();" href="/IEA_STATS_prova/"> IEA Statistics</a></p-->
	 
	 <!--input type="button" class="btn_color" onclick = "sendData();" value="1 - Select custom area"-->
	 </form>
	 
</main>




<nav role='navigation'>
  <a class="col_home" href="/home_page/">Home</a>
  <a class="col_privata" href="/mob_privata_page/" style="color:#ffffff;">Private Mobility</a>
  <!--img border="0" alt="W3Schools" src="/static/img/icone_mezzi_priv.png" width="30" height="30"-->
  <a class="col_collettivo" href="/public_transport_page/">Public Transport</a>
  <a class="col_scenari" href="/TRIP_LEGS/">Avoid-Shift measures</a>
  <a href="/charging_infrastructure_OSM/">EVs Charging Profile</a>
  <a class="col_impatti" href="/public_transport_page/">Impacts</a>
  <a class="IEA_statistics"  onclick="$('#loading').show();" href="/IEA_STATS_show/">statistics IEA</a>
</nav>  





	
<!--we are inside the area of the map-->
<div id="map">  </div>




<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link rel="stylesheet" href="https://leaflet.github.io/Leaflet.draw/src/leaflet.draw.css"/>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>


<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw.js"></script>
<script src = "https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js" integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ==" crossorigin = "anonymous" referrerpolicy = "no-referrer"> </script>

  
<!-- Load data .geojson -->
<!--script src="{{ url_for('static', filename='hexagons_aggr_POP_ROMA_2011.geojson') }}" /></script-->
<!-- ZMU zones with population data -->
<script src="{{ url_for('static', filename='zmu_aggr_POP_ROMA_2011.geojson') }}" /></script>
<!-- aggregation by zmu -->
<script src="{{ url_for('static', filename='aggregated_zmu_filtered.geojson') }}" /></script>
<!-- POINTS of INTERESTS (PARKINGs) -->
<script src="{{ url_for('static', filename='POIS_parking.geojson') }}" /></script>
<!-- POINTS of INTERESTS (all AMENITIES) -->
<script src="{{ url_for('static', filename='layer_POIS_amenities.geojson') }}" /></script>
<!-- POINTS of INTERESTS (all BUILDINGS) -->
<script src="{{ url_for('static', filename='layer_POIS_residential.geojson') }}" /></script>
<!-- ALL POINTS of INTERESTS (all BUILDINGS and AMENITIES) -->
<script src="{{ url_for('static', filename='zmu_POIS_ROMA_2011.geojson') }}" /></script>

 <script src="{{ url_for('static', filename='leaflet.motion.min.js') }}" /></script>  
 
 
 <!-- load custom polygons and border of custom polygon-->
<!--script src="{{ url_for('static', filename='ZMUs_custom_selected.geojson') }}" /></script-->
<!--script src="{{ url_for('static', filename='BORDER_selected_ZMUs.geojson') }}" /></script-->
<script src="{{ url_for('static', filename='charging_stations_ZMU.geojson') }}" /></script>



  <script>

     // ----------------------------------------------------

      // Hack to autoset the iframe height.
      window.addEventListener("load", function() {
        window.setTimeout(function() {
          setFrameHeight(document.documentElement.clientHeight)
        }, 0);
      });
	
	

	
	var zmu_day = "{{ session['ZMU_day']}}"
	// alert(zmu_day);
		 
	var zmu_day = zmu_day.slice(0, 10);
	// alert(zmu_day);
		 
	document.addEventListener("DOMContentLoaded", function(){
    // var data_selezionata = "{{ session['ZMU_day'] }}";
	var data_selezionata = zmu_day;
	// alert(data_selezionata);
	document.getElementById('registrationday').value = data_selezionata;  
	});
	
	
	var zmu_hour = "{{ session['ZMU_hour']}}"
	// alert(zmu_hour);
	
    document.addEventListener("DOMContentLoaded", function(){
	// var ora_selezionata =  selected_hour_ZMU;
	var ora_selezionata =  zmu_hour;
	// alert(ora_selezionata);
	document.getElementById('registrationhour').value = ora_selezionata;  
	});
	
	
	
	
	

	
	$('form select').on('change', function(){
		$(this).closest('form').submit()
		$('#loading').show();
	});

	



	
	 ///////////////////////////---------------------------------------------------------------------/////////////////////////////////////////////
	  ///////////////////////////---------------------------------------------------------------------////////////////////////////////////////////
	   ///////////////////////////---------------------------------------------------------------------///////////////////////////////////////////
	    ///////////////////////////---------------------------------------------------------------------//////////////////////////////////////////
		///////////////////////////---------------------------------------------------------------------//////////////////////////////////////////
        ///////////////////////////---------------------------------------------------------------------//////////////////////////////////////////
      ///////////////////////////---------------------------------------------------------------------////////////////////////////////////////////
    ///////////////////////////---------------------------------------------------------------------//////////////////////////////////////////////
    ///////////////////////////---------------------------------------------------------------------//////////////////////////////////////////////
	 
	  
	// ADD Leaflet map
	
		
		const osm  = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
			maxZoom: 19,
			attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		})
         
	    var carto = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'
         });
		 
	
	
	// control that shows state info on hover
	const info = L.control(); 
	
	info.onAdd = function (map) {
	this._div = L.DomUtil.create('div', 'info');
	this.update();
	return this._div;
	};
		
	
   
	function getColor_hex_traffic(d) {
		return d >= 40 ? '#0c2c84' :
			d > 30  ? '#225ea8' :
			d > 15  ? '#1d91c0' :
			d > 12.5  ? '#41b6c4' :
			d > 10  ? '#7fcdbb' :
			d > 7.5  ? '#c7e9b4' :
			d > 5  ? '#edf8b1' :
			d >= 0   ? '#fdfdbf' : '#fdfdbf';
			} 
			
	function getColor_population_hex(d) {
		return d >= 100 ? '#2d2d4c' :
		    d > 95 ? '#3d3d66' :
		    d > 90 ? '#4c4c7f' :
		    d > 85 ? '#5b5b99' :
			d > 80 ? '#6b6bb2' :
			d > 75 ? '#7a7acc' :	
			d > 70 ? '#8989e5' :
		    d > 65 ? '#9999ff' :
		    d > 60 ? '#a3a3ff' :
			d > 55 ? '#adadff' :			
			d > 50 ? '#b7b7ff' :
			d > 45 ? '#c1c1ff' :
		    d > 40  ? '#ccccff' :  
		    d > 30  ? '#d6d6ff' :
			d > 20  ? '#e0e0ff' :
			d > 10  ? '#eaeaff' :
			d >= 0   ? '#f4f4ff' : '#ffffff';
			}
			
		
			
			
	function getColor_zmu_origin_destinations(d) {
		return d >= 2000 ? '#071a4f' :
		    d > 1000  ? '#0c2c84' :
		    d > 500  ? '#225ea8' : 
			d > 300  ? '#546ba8' :
			d > 75  ? '#1d91c0' :
			d > 30  ? '#41b6c4' :
			d > 20  ? '#7fcdbb' :
			d > 10  ? '#c7e9b4' :
			d > 3  ? '#d5df9f' :
			d >= 0.5   ? '#fdfdbf' : '#fdfdbf';
			}    
			
			
	function getColor_census(d) {
		return d > 20000 ? '#800026' :
			d > 10000  ? '#97001e' :
			d > 5000  ? '#BD0026' :
			d > 3000  ? '#E31A1C' :
			d > 2000  ? '#FC4E2A' :
			d > 1000   ? '#FD8D3C' :
			d > 300   ? '#FEB24C' :
			d > 50   ? '#FED976' : '#FFEDA0';
				}
	
	
	function getColor_legend(d) {
		return d >= 15000 ? '#2d2d4c' :
		    d > 6000 ? '#3d3d66' :	
		    d > 3500 ? '#4c4c7f' :
			d > 2500 ? '#5b5b99' :
			d > 1500 ? '#6b6bb2' :				
			d > 1300 ? '#7a7acc' :	
		    d > 1000 ? '#8989e5' :	
		    d > 800 ? '#9999ff' :			
		    d > 600 ? '#a3a3ff' :	
            d > 500 ? '#adadff' :
			d > 300 ? '#b7b7ff' :
			d > 250 ? '#c1c1ff' :
		    d > 200 ? '#ccccff' :
			d > 100 ? '#d6d6ff' :
			d > 50   ? '#e0e0ff' :
			d > 20   ? '#eaeaff' :
			d >= 0   ? '#f4f4ff' : '#ffffff';
			}
	
	
	    /* LEGEND USED FOR THE HEXAGONAL TESSELLATION */
		var legend = L.control({position: 'bottomright'});
		
            legend.onAdd=function(map){
                var div=L.DomUtil.create('div','info legend');
							
				   const labels=["from 0 to 20",
								"from 20 to 50",
								"from 50 to 100",
								"from 100 to 200",
								"from 200 to 250",
								"from 250 to 300",
								"from 300 to 500",
								"from 500 to 600",
								"from 600 to 800",
								"from 800 to 1000",
								"from 1000 to 1300",
								"from 1300 to 1500",
								"from 1500 to 2500",
								"from 2500 to 3500",
								"from 3500 to 6000",
								"from 6000 to 15000",
								" > 15000"];
				 const grades = [0, 20, 50, 100, 200 ,250 , 300, 500, 600, 800, 1000, 1300, 1500, 2500, 3500, 6000, 15000];

                div.innerHTML='<div><b>Population(hex)</b></div';
				
			  for(var i=0; i <grades.length; i++){
					 div.innerHTML+='<i style="background:'+getColor_legend(grades[i]) + ' ">&nbsp;</i>&nbsp;&nbsp;' +labels[i]+'<br/>';        						 
                }
                return div;
            }
			
			
			//////* LEGEND USED FOR CENSUARY DATA *//////////
			
			/*
			var legend_censuary = L.control({position: 'bottomright'});
		
            legend_censuary.onAdd=function(map){
                var div=L.DomUtil.create('div','info legend');
							
				   const labels=["from 0 to 50",
								"from 50 to 300",
								"from 300 to 1000",
								"from 1000 to 2000",
								"from 2000 to 3000",
								"from 3000 to 5000",
								"from 5000 to 10000",
								"from 10000 to 20000",
								" > 20000"];
				 const grades = [0, 50, 300, 1000, 2000, 3000, 5000, 10000, 20000];

                div.innerHTML='<div><b>Population(zmu)</b></div';
				
			  for(var i=0; i <grades.length; i++){
					 div.innerHTML+='<i style="background:'+getColor_census(grades[i]) + ' ">&nbsp;</i>&nbsp;&nbsp;' +labels[i]+'<br/>';        						 
                }
                return div;
            }
			*/
			
			
			
		//////////* LEGEND USED FOR ZMU DATA  (number of vehicles at destination per 1000 population)*////////////  
			var legend_ZMU = L.control({position: 'bottomright'});
		
            legend_ZMU.onAdd=function(map){
                var div=L.DomUtil.create('div','info legend');
							
				   const labels=["from 0 to 0.5",
								"from 0.5 to 3",
								"from 3 to 10",
								"from 10 to 20",
								"from 20 to 30",
								"from 30 to 75",
								"from 75 to 300",
								"from 300 to 500",
								"from 500 to 1000",
								"from 1000 to 2000",
								" > 2000"];
				 const grades = [0, 0.5, 3, 10, 20, 30, 75, 300, 500, 1000, 2000];

                div.innerHTML='<div><b>N vehicles per 1000 habit.</b></div';
				
			  for(var i=0; i <grades.length; i++){
					 div.innerHTML+='<i style="background:'+getColor_zmu_origin_destinations(grades[i]) + ' ">&nbsp;</i>&nbsp;&nbsp;' +labels[i]+'<br/>';        						 
                }
                return div;
            }
            
            
		
		
			
		
	

	info.update = function (props) {
		const contents = props ? `<b>${props.POP_TOT_ZMU}</b> people` : 'Hover over a traffic zone';
		this._div.innerHTML = `<h4>Total Population Number</h4>${contents}`;
	};
	
	
	
		const selectedStyle = {
		  color: '#000000',
		  weight: 0.1,
		  opacity: 0.1,
		}
			
			
		const selectedStyle_highlight = {
		  color: 'black',
		  weight: 3,
		  opacity: 0.9,
		}
		
		
	
		
		const selectedStyle_mouseout = {
		  color: 'black',
		  weight: 2,
		  opacity: 0.1,
		}
		
	
				
				
		
	// get color depending on population number value

			function style_colors(feature) {
				return {
					weight: 0.1,
					opacity: 0.1,
					color: '#ffffff',
					dashArray: '2',
					fillOpacity: 0.7,
					fillColor: getColor_population_hex(feature.properties.percentile)
				};
			}
			
			
		function style_colors_matched(feature) {
			return {
				weight: 0.5,
				opacity: 0.7,
				color: '#666',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: getColor_hex_traffic(feature.properties.load)
			};
		}
		
		
		
		function style_colors_zmu(feature) {
			return {
				weight: 0.5,
				opacity: 0.7,
				color: '#666',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: getColor_zmu_origin_destinations(feature.properties.counts)
			};
		}
		
		
		function style_colors_POIS_ZMU(feature) {
			return {
				weight: 3,
				opacity: 0.3,
				color: 'black',
				dashArray: '3',
				fillOpacity: 0.1,
				fillColor: 'blue'
			};
		}
		
		
		
		
		
		function style_colors_POIS(feature) {
			return {
				weight: 0.5,
				opacity: 0.7,
				color: '#666',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: 'blue'
			};
		}
		
		
		
		function style_colors_POIS_amenities(feature) {
			return {
				weight: 0.5,
				opacity: 0.7,
				color: '#666',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: 'red'
			};
		}
		
		
		function style_colors_POIS_residential(feature) {
			return {
				weight: 0.5,
				opacity: 0.7,
				color: '#666',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: 'yellow'
			};
		}
		
		
				
		
	    // used to color ZMU zones with POPULATION data 2011
		function style_pop(feature) {
			return {
				weight: 0.8,
				opacity: 1,
				color: '#666',
				dashArray: '3',
				fillOpacity: 0.5,
				fillColor: getColor_census(feature.properties.POP_TOT_ZMU)
			};
		}
		
		
		// used to color ZMU zones with RESIDENCE data 2011
		function style_homes(feature) {
			return {
				weight: 0.8,
				opacity: 1,
				color: '#666',
				dashArray: '3',
				fillOpacity: 0.5,
				fillColor: getColor_census(feature.properties.RES_TOT_ZMU)
			};
		}
		
		
		
		
		/*
		function myStyle_matching(feature) {
			return {
				weight: feature.properties.load/6,
				opacity: 1,
				color: 'black',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: '#00000000'
			};
		 }
		 
		 
		 const selectedStyle_matching = {
		  color: 'orange',
		  weight: 5
		}
		*/
		
		
	
	

		function highlightFeature(e) {
			const layer = e.target;
			layer.setStyle({
				weight: 3,
				color: '#666',
				dashArray: '',
				fillOpacity: 0.9
			});

			layer.bringToFront();

			info.update(layer.feature.properties);
		}
		
		
		
		
		
		

         
		const censuary_default = L.geoJson(zmu_counts, {
				style: style_pop,
				onEachFeature
			});
			
		
		function resetHighlight(e) {
			censuary_default.resetStyle(e.target);
			info.update();
		}

		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds());
		}

		function onEachFeature(feature, layer) {
			layer.on({
				mouseover: highlightFeature,
				mouseout: resetHighlight,
				//click: zoomToFeature
			});
		}
		
		
		
		
	 // alert("...I AM HERE...");
		
		
		
	    /*------------DEFAULT LAYER -----------------*/
	    const censuary_Layer = L.layerGroup();
		censuary_Layer.addLayer(censuary_default);		
	 
	
			
	 
	 
	 
	 
	 const selectElement = document.querySelector('.selector');

		selectElement.addEventListener('change', (event) => {
		  const result = document.querySelector('.result');
		  //result.textContent = `Display ${event.target.value}`;
		  
		  
		 /*--------- ADD POPULATION LAYER ---------------*/
		 if (event.target.value == 'Population') {	
		 
		  censuary_Layer.clearLayers();
			// map.removeLayer(censuary_Layer);
			// map.removeLayer(mapmatched_Layer);
			
		//alert("...POP_TOT_ZMU....total population...");
		  const censuary = L.geoJson(zmu_counts, {
				style: style_pop,
				onEachFeature
			});
			
		function resetHighlight(e) {
			censuary.resetStyle(e.target);
			//info.update();
			info.update = function (props) {
				const contents = props ? `<b>${props.POP_TOT_ZMU}</b> people` : 'Hover over a censuary zone';
				this._div.innerHTML = `<h4>Total Population Number</h4>${contents}`;
			};
		}

		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds());
		}

		function onEachFeature(feature, layer) {
			layer.on({
				mouseover: highlightFeature,
				mouseout: resetHighlight,
				//click: zoomToFeature
			});
		}
			
		  censuary_Layer.addLayer(censuary);
		  censuary_Layer.addTo(map);
		}
		
		
		
		/*------ ADD RESIDENTIAL HOME LAYER ---------------*/
		 if (event.target.value == 'Residences') {	
		 
		 censuary_Layer.clearLayers();
			//map.removeLayer(censuary_Layer);
			//map.removeLayer(mapmatched_Layer);
			
				//alert("...E3....Residential homes...");
		  const censuary = L.geoJson(zmu_counts, {
				style: style_homes,
				onEachFeature
			});
			
			
		function resetHighlight(e) {
			censuary.resetStyle(e.target);
			//info.update();
			info.update = function (props) {
				const contents = props ? `<b>${props.RES_TOT_ZMU}</b> residential homes` : 'Hover over a censuary zone';
				this._div.innerHTML = `<h4>Total Residential Homes</h4>${contents}`;
			};
		}

		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds());
		}

		function onEachFeature(feature, layer) {
			layer.on({
				mouseover: highlightFeature,
				mouseout: resetHighlight,
				//click: zoomToFeature
			});
		}
			
			
		  censuary_Layer.addLayer(censuary);
			censuary_Layer.addTo(map);
		}
		
		
		});
		
		
		
	
			
		
		  

         /////////----------- Points of Interest (POIS) in ZMUs -------/////////////////////////////////////////	
		 
			 var POIS_ZMU = L.geoJSON(zmu_POIS_counts, { style: style_colors_POIS_ZMU, 	
				  onEachFeature: function (feature, layer) {
				  layer.on('mouseover', function () {
				   layer.setStyle(selectedStyle_highlight);
				  });
				  
					var popupText = '';
					popupText += (feature.properties.apartments) ? '<h3>Apartments: ' + feature.properties.apartments : '';
					popupText += (feature.properties.church) ? '<h3>Church: ' + feature.properties.church : ''
					popupText += (feature.properties.residential) ?  '<h3>Residential: ' + feature.properties.residential : '';
					popupText += (feature.properties.hotel) ? '<h3>Hotel: ' + feature.properties.hotel : ''
					popupText += (feature.properties.office) ? '<h3>Office: ' + feature.properties.office : ''
					popupText += (feature.properties.basilica) ? '<h3>Hotel: ' + feature.properties.basilica : ''
					popupText += (feature.properties.house) ? '<h3>House: ' + feature.properties.house : ''
					popupText += (feature.properties.public) ? '<h3>Public: ' + feature.properties.public : ''
					popupText += (feature.properties.market) ? '<h3>Market: ' + feature.properties.market : ''
					popupText += (feature.properties.detached) ? '<h3>Detached: ' + feature.properties.detached : ''
					popupText += (feature.properties.synagogue) ? '<h3>Synagogue: ' + feature.properties.synagogue : ''
					popupText += (feature.properties.roof) ? '<h3>Roof: ' + feature.properties.roof : ''
					popupText += (feature.properties.supermarket) ? '<h3>Supermarket: ' + feature.properties.supermarket : '';
					popupText += (feature.properties.retail) ? '<h3>Retail: ' + feature.properties.retail : ''
					popupText += (feature.properties.congress_centre) ? '<h3>Congress centre: ' + feature.properties.congress_centre : ''
					popupText += (feature.properties.government) ? '<h3>Government: ' + feature.properties.government : ''
					popupText += (feature.properties.commercial) ? '<h3>Commercial: ' + feature.properties.commercial : ''
					popupText += (feature.properties.semidetached_house) ? '<h3>Semidetached house: ' + feature.properties.semidetached_house : ''
					
					popupText += (feature.properties.arts_centre) ? '<h3>Arts centre: ' + feature.properties.arts_centre : ''
					popupText += (feature.properties.bus_station) ? '<h3>Bus station: ' + feature.properties.bus_station : ''
					popupText += (feature.properties.cafe) ? '<h3>Cafe: ' + feature.properties.cafe : ''
					popupText += (feature.properties.fast_food) ? '<h3>Fast food: ' + feature.properties.fast_food : ''
					popupText += (feature.properties.pharmacy) ? '<h3>Pharmacy: ' + feature.properties.pharmacy : ''
					popupText += (feature.properties.parking) ? '<h3>Parking: ' + feature.properties.parking : ''
					popupText += (feature.properties.place_of_worship) ? '<h3>Place of worship: ' + feature.properties.place_of_worship : ''
					popupText += (feature.properties.restaurant) ? '<h3>Restaurant: ' + feature.properties.restaurant : ''
					popupText += (feature.properties.bar) ? '<h3>Bar: ' + feature.properties.bar : ''
					popupText += (feature.properties.bicycle_parking) ? '<h3>Bicycle parking: ' + feature.properties.bicycle_parking : ''
					popupText += (feature.properties.charging_station) ? '<h3>Charging station: ' + feature.properties.charging_station : ''
					popupText += (feature.properties.theatre) ? '<h3>Theatre: ' + feature.properties.theatre : ''
					popupText += (feature.properties.cinema) ? '<h3>Cinema: ' + feature.properties.cinema : ''
					popupText += (feature.properties.library) ? '<h3>Library: ' + feature.properties.library : ''
					popupText += (feature.properties.marketplace) ? '<h3>Marketplace: ' + feature.properties.marketplace : ''
					popupText += (feature.properties.motorcycle_parking) ? '<h3>Motorcycle parking: ' + feature.properties.motorcycle_parking : ''
					popupText += (feature.properties.parking_entrance) ? '<h3>Parking entrance: ' + feature.properties.parking_entrance : ''
					popupText += (feature.properties.police) ? '<h3>Police: ' + feature.properties.police : ''
					popupText += (feature.properties.public_building) ? '<h3>Public building: ' + feature.properties.public_building : ''
					popupText += (feature.properties.school) ? '<h3>School: ' + feature.properties.school : ''
					popupText += (feature.properties.social_facility) ? '<h3>Social facility: ' + feature.properties.social_facility : ''
					popupText += (feature.properties.car_sharing) ? '<h3>Car sharing: ' + feature.properties.car_sharing : ''
					popupText += (feature.properties.pub) ? '<h3>Pub: ' + feature.properties.pub : ''
					popupText += (feature.properties.taxi) ? '<h3>Taxi: ' + feature.properties.taxi : ''
					popupText += (feature.properties.university) ? '<h3>University: ' + feature.properties.university : ''
					popupText += (feature.properties.college) ? '<h3>College: ' + feature.properties.college : ''
					popupText += (feature.properties.community_centre) ? '<h3>Community centre: ' + feature.properties.community_centre : ''
					popupText += (feature.properties.doctors) ? '<h3>Doctors: ' + feature.properties.doctors : ''
					popupText += (feature.properties.townhall) ? '<h3>Townhall: ' + feature.properties.townhall : ''
					popupText += (feature.properties.parking_space) ? '<h3>parking space: ' + feature.properties.parking_space : ''		
					popupText += (feature.properties.hospital) ? '<h3>Hospital: ' + feature.properties.hospital : '';
					popupText += (feature.properties.music_school) ? '<h3>Music school: ' + feature.properties.music_school : '';
					popupText += (feature.properties.fuel) ? '<h3>Fuel: ' + feature.properties.fuel : '';
					popupText += (feature.properties.car_rental) ? '<h3>Car rental: ' + feature.properties.car_rental : '';
					popupText += (feature.properties.dentist) ? '<h3>Dentist: ' + feature.properties.dentist : '';
					popupText += (feature.properties.clinic) ? '<h3>Clinic: ' + feature.properties.clinic : '';
					popupText += (feature.properties.social_centre) ? '<h3>Social centre: ' + feature.properties.social_centre : '';
					popupText += (feature.properties.events_venue) ? '<h3>Events venue: ' + feature.properties.events_venue : '';
					popupText += (feature.properties.research_institute) ? '<h3>Research institute: ' + feature.properties.research_institute : '';
					popupText += (feature.properties.ferry_terminal) ? '<h3>Ferry terminal: ' + feature.properties.ferry_terminal : '';
					popupText += (feature.properties.language_school) ? '<h3>Language school: ' + feature.properties.language_school : '';
					popupText += (feature.properties.kindergarten) ? '<h3>Kindergarten: ' + feature.properties.kindergarten : '';
					popupText += (feature.properties.conference_centre) ? '<h3>Conference centre: ' + feature.properties.conference_centre : '';
					popupText += (feature.properties.courthouse) ? '<h3>Courthouse: ' + feature.properties.courthouse : '';
					popupText += (feature.properties.tourism) ? '<h3>Tourism: ' + feature.properties.tourism : '';
					popupText += (feature.properties.weighbridge) ? '<h3>Weighbridge: ' + feature.properties.weighbridge : '';
					popupText += (feature.properties.childcare) ? '<h3>Childcare: ' + feature.properties.childcare : '';
					popupText += (feature.properties.nursing_home) ? '<h3>Nursing home: ' + feature.properties.nursing_home : '';
					popupText += (feature.properties.coworking_space) ? '<h3>Coworking space: ' + feature.properties.coworking_space : '';
					popupText += (feature.properties.casino) ? '<h3>Casino: ' + feature.properties.casino : '';
					popupText += (feature.properties.community_centres) ? '<h3>Community centres: ' + feature.properties.community_centres : '';
										
					layer.bindTooltip(popupText);
					
					
					
			layer.on('mouseout', function (e) {
						layer.setStyle(selectedStyle_mouseout); 
					});	
				}
				});
				
		const POIS_Layer_zmu = L.layerGroup();
		POIS_Layer_zmu.addLayer(POIS_ZMU);
		

		
		
		
		
		/////////----- ADD POINTS of INTERESTS (PARKINGS) nearby chosen location -----------////////////////////////
		var POIS_PARKING = L.geoJSON(POIS_parking, { style: style_colors_POIS, 	
			  onEachFeature: function (feature, layer) {
			  layer.on('mouseover', function () {
			   layer.setStyle(selectedStyle);
			  });
				layer.bindTooltip('<h3><p>amenity: '+feature.properties.amenity+'</p>');
				layer.on('mouseout', function (e) {
					layer.setStyle(style_colors_POIS); 
				});	
			}
			});
			
		
		const POIS_Layer = L.layerGroup();
		POIS_Layer.addLayer(POIS_PARKING);
		
		
		
	    /////////----- ADD POINTS of INTERESTS (all AMENITIES) nearby chosen location -----------////////////////////////
		var POIS_AMENITIES = L.geoJSON(POIS_amenities, { style: style_colors_POIS_amenities, 	
			  onEachFeature: function (feature, layer) {
			  layer.on('mouseover', function () {
			   layer.setStyle(selectedStyle);
			  });
				layer.bindTooltip('<h3><p>amenity: '+feature.properties.amenity+'</p>');
				layer.on('mouseout', function (e) {
					layer.setStyle(style_colors_POIS_amenities); 
				});	
			}
			});
			
		
		const POIS_Layer_amenities = L.layerGroup();
		POIS_Layer_amenities.addLayer(POIS_AMENITIES);
		
		
		
		/////////----- ADD POINTS of INTERESTS (all residential) nearby chosen location -----------////////////////////////
		var POIS_RESIDENTIALS = L.geoJSON(POIS_residential, { style: style_colors_POIS_residential, 	
			  onEachFeature: function (feature, layer) {
			  layer.on('mouseover', function () {
			   layer.setStyle(selectedStyle);
			  });
				layer.bindTooltip('<h3><p>building: '+feature.properties.building+'</p>');
				layer.on('mouseout', function (e) {
					layer.setStyle(style_colors_POIS_residential); 
				});	
			}
			});
			
		
		const POIS_Layer_residential = L.layerGroup();
		POIS_Layer_residential.addLayer(POIS_RESIDENTIALS);
		
		
		
		/*
	   ///--------- ADD AGGREGATED POPULATION LAYER ---------------///
	 	var hex_all = L.geoJSON(hex_counts, { style: style_colors, 	
		  onEachFeature: function (feature, layer) {
		  layer.on('mouseover', function () {
           layer.setStyle(selectedStyle);
          });
			layer.bindTooltip('<h3><p>Population: '+feature.properties.POP_TOT_HEX+'</p>');
			layer.on('mouseout', function (e) {
				layer.setStyle(style_colors); 
			});	
		}
		});   */
		
		  //Using a Layer Group to add/ remove data from the map.
	     // censuary_Layer.addLayer(hex_all);
		
		
		
		
		// -------->show TIMESERIES of mean "Number of Vehicles", "triptime", "tripdistance" and "stoptime" @ DESTINATION zone in Plotly within the tooltip...---------------------/////////////////////
		const time_series_counts = '<iframe src="{{ url_for('figure_plotly1') }}" width="325" height="225"></iframe>'
		const time_series_tripdistance = '<iframe src="{{ url_for('figure_plotly2') }}" width="325" height="225"></iframe>'
		const time_series_triptime = '<iframe src="{{ url_for('figure_plotly3') }}" width="325" height="225"></iframe>'
		const time_series_stoptime = '<iframe src="{{ url_for('figure_plotly4') }}" width="325" height="225"></iframe>'
		
		
		
		/////////----------- AGGREGATED TRAFFIC DATA in ZMUs areas by HOURS -------/////////////////////////////////////////	
	    var matched_zmu_by_hour = L.geoJSON(aggregated_matched_routes_zmu, { style: style_colors_zmu, 	
			  onEachFeature: function (feature, layer) {
			  layer.on('click', function () {
			   layer.setStyle(selectedStyle_highlight);
			   	var feature_variable = layer.feature.properties.index_zmu;
				 // alert("The variable named x1 has value:  " + feature_variable);
				 
				 //----> send layer.feature.properties.zmu to python
				 fetch('/process_zmu_index', {
					  method: 'POST',
					  headers: {
						'Content-Type': 'application/json'
					  },
					  body: JSON.stringify({data: feature_variable})
					})
					.then(response => response.text())
					.then(result => {
					  console.log(result);
					})
					.catch(error => {
					  console.error('Error:', error);
					});
				 
			  });
				// layer.bindPopup('<h3>Counts: '+feature.properties.counts  + time_series_counts + time_series_tripdistance + time_series_triptime + '<p>',{maxWidth : 860});
				
				var popup_zmu = '';
				popup_zmu += time_series_counts;
				popup_zmu += time_series_tripdistance;
				popup_zmu += time_series_triptime;
				popup_zmu += time_series_stoptime;
				popup_zmu += (feature.properties.counts) ? '<h3>Number of vehicles: ' + feature.properties.counts : '';
				popup_zmu += (feature.properties.nome_comun) ? '<h3>Comune: ' + feature.properties.nome_comun : '';
				popup_zmu += (feature.properties.quartiere) ? '<h3>Quartiere: ' + feature.properties.quartiere : '';
				popup_zmu += (feature.properties.index_zmu) ? '<h3>zmu index: ' + feature.properties.index_zmu : '';
				popup_zmu += (feature.properties.zmu) ? '<h3>zmu: ' + feature.properties.zmu : '';
				popup_zmu += (feature.properties.POP_TOT_ZMU) ? '<h3>Population: ' + feature.properties.POP_TOT_ZMU : '';	
				
				layer.bindPopup(popup_zmu ,{maxWidth : 670}); 
				layer.on('mouseout', function (e) {
					layer.setStyle(selectedStyle_mouseout); 
				});	
			}
				
			});
		
			
		const mapmatched_Layer_zmu = L.layerGroup();
		mapmatched_Layer_zmu.addLayer(matched_zmu_by_hour);
		
		
	

		
		//// ----- ZMU zones -----------------------------////
		function style_colors_ZMU_zones(feature) {
			return {
				weight: 1,
				opacity: 0.6,
				color: 'black',
				dashArray: '3',
				fillOpacity: 0.0,
				fillColor: 'white'
			};
		}
		
		
		const selectedStyle_highlight_ZONES = {
		  color: 'orange',
		  weight: 3,
		  opacity: 0.9,
		}
		
		
	    const selectedStyle_mouseout_ZONES = {
		  color: 'black',
		  weight: 1,
		  opacity: 0.6,
		}
		
		
		
		/// add ZMU zones  borders  /////////////////////////////////////////////////////
		var ZMU_zones = L.geoJSON(charging_data, { style: style_colors_ZMU_zones, 	
				  onEachFeature: function (feature, layer) {
				  layer.on('mouseover', function () {
				   layer.setStyle(selectedStyle_highlight_ZONES);
				  });
		var popupText = '';
					popupText += (feature.properties.quartiere) ? '<h3>Quartiere: ' + feature.properties.quartiere : '';
					popupText += (feature.properties.nome_comun) ? '<h3>Comune: ' + feature.properties.nome_comun : '';
					popupText += (feature.properties.n_charging_stations) ? '<h3>n. charging stations: ' + feature.properties.n_charging_stations : '' ;	
					popupText += (feature.properties.POP_TOT_ZMU) ? '<h3>Population: ' + feature.properties.POP_TOT_ZMU : '';		        	
                    popupText += (feature.properties.Available_Power) ? '<h3>Power (Watt): ' + feature.properties.Available_Power : '' ;						
					layer.bindTooltip(popupText);		
		layer.on('mouseout', function (e) {
					layer.setStyle(selectedStyle_mouseout_ZONES); 
				});	
			}
			});

	
		const ZMU_zones_Layer = L.layerGroup();
		ZMU_zones_Layer.addLayer(ZMU_zones);	
					


		
		

		
    /////////---------------------------------/////////////////////////////////////////	
    /////////---------------------------------/////////////////////////////////////////	
    /////////---------------------------------/////////////////////////////////////////	
		

	 const map = L.map('map', {
			center: [41.8946, 12.4873],
			zoom: 10,
			layers: [carto, mapmatched_Layer_zmu]  //osm 
		});
		
		// legend.addTo(map);
		// legend_censuary.addTo(map);
		legend_ZMU.addTo(map);
		info.addTo(map);
		
		
		
		
	///// ------ add custom geometric shapes to select areas ------- ///////////////
	var options = {
		draw: {
			circle: false, // Turns off this drawing tool
			rectangle: false,
			marker: false,
			circlemarker: false,
			polyline: false
		}
	};

	var drawControl = new L.Control.Draw(options);
	map.addControl(drawControl);

	map.on(L.Draw.Event.CREATED, function (e) {
		var type = e.layerType,
			layer = e.layer;

        
		if (type === "polyline") {
			var line = L.motion.polyline(layer.getLatLngs(), {
				color: "orange"
			}, {
				auto: true,
				easing: L.Motion.Ease.swing
			}).motionSpeed(100000).addTo(map);
		} 

		if (type === "polygon") {
			L.motion.polygon(layer.getLatLngs(), {
				color: "red",
				fill: true,
				fillOpacity: 0.4
			},{
				auto: true
			}, {
				removeOnEnd: true,
				icon: L.divIcon({className:"red", html: "<i class='fa fa-superpowers fa-spin fa-2x' aria-hidden='true' motion-base='0'></i>", iconSize: L.point(24, 24), iconAnchor: L.point(5, 22)})
			}).motionDuration(10000).addTo(map);
			}
				
				
			var resp = layer.getLatLngs().map(function(point) {
					   polys = layer.getLatLngs()
					   // window.alert(polys);				 
				});
	        });
		
	
			
		// ------- SAVE Polygon selection ------- //////////
		function sendData() {
            // var value = document.getElementById('input').value;
			var value = polys;
            $.ajax({
                url: '/custom_polygon',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 'value': value }),
                success: function(response) {
                    document.getElementById('output').innerHTML = response.result;
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }
		
		

		
	
	//------------------------- choose location on the map manually...

	 map.on('click', 
			function(e){
				document.getElementById('lat').value = e.latlng.lat;
				document.getElementById('lng').value = e.latlng.lng;
				var newMarker = L.marker(e.latlng, {draggable:'true'}).addTo(map)	
    });
		
		
		
		{% for marker in markers %}
		L.marker([{{ marker['lat'] }}, {{ marker['lon'] }}]).addTo(map)
		.bindPopup("{{ marker['popup'] }}")
		.openPopup();
		{% endfor %}
		
		
		
		const baseLayers = {
			//'Streets': streets,
			'OpenStreetMap': osm,
			'Carto': carto
		};
		
		const overlays = {
			'Traffic Zones': ZMU_zones_Layer,
			'Traffic Zones & Censuary': censuary_Layer,
			'Frequency visiting zmu @DESTINATION': mapmatched_Layer_zmu,
			'POIS & Residences': POIS_Layer_zmu,
			'POIS_Parking': POIS_PARKING,
			'POIS_Amenities': POIS_AMENITIES,
			'POIS_Residentials': POIS_RESIDENTIALS
			
		};
		
		
		const layerControl = L.control.layers(baseLayers, overlays ,{collapsed:false,}).addTo(map);	
			
		//const aggregated_pop = L.layerGroup([hex_all]);
		const cens_layer = L.layerGroup([censuary_default]);
		
		
		const satellite = L.tileLayer(mbUrl, {id: 'mapbox/satellite-v9', tileSize: 512, zoomOffset: -1, attribution: mbAttr});
		layerControl.addBaseLayer(satellite, 'Satellite');
		// layerControl.addOverlay(hex_all, 'aggregated population (hex)');
		layerControl.addOverlay(POIS_PARKING, 'parkings');
		layerControl.addOverlay(POIS_AMENITIES, 'amenities');
		layerControl.addOverlay(POIS_RESIDENTIALS, 'buildings')
		
		
	
	
	window.addEventListener('resize', 
	() => map.getViewPort().resize());
	
	

  </script>
</body>
</html>